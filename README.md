# Smart Crypto Alert (Binance Futures USDT)

**融合形态识别的智能多周期加密货币告警系统**

集成 K线形态识别、图表形态分析、埋伏币扫描于一体的专业级监控机器人。基于 K 线开盘价的涨跌幅阈值触发，融合 technicalindicators 库与自定义规则，实现多重信号确认，通过 Telegram 实时推送。

## ✨ 核心功能

### 📊 实时监控系统
- ✅ 多周期监控（5m/15m/1h/4h/1d 可开关）
- ✅ 阈值基于 K 线开盘价
- ✅ 量能中位数倍数（抗噪声）
- ✅ BTC 市场趋势过滤（山寨币风险控制）
- ✅ 冷却机制（避免重复提醒）
- ✅ 每日提醒计数自动重置

### 🔍 形态识别引擎（融合方案）
**K线形态识别**（使用 technicalindicators 库）：
- 锤子线、上吊线、十字星
- 看涨/看跌吞没、早晨/黄昏之星
- 蜻蜓/墓碑十字、流星线等

**图表形态识别**（自定义规则）：
- 双底/双顶（反转形态）
- 平台整理突破
- V形反转
- 多重信号融合确认

### 🎯 埋伏币扫描器（6小时融合扫描）
- ✅ **融合评分系统**：日线（底部形态）+ 小时线（动态信号）
- ✅ **扫描频率**：每6小时（2:00, 8:00, 14:00, 20:00）
- ✅ **评分系统**：日线0-15分 + 小时线0-10分 = 总分0-20+分
- ✅ **自动管理**：评分≥7分自动加入观察池，每5分钟检测入场信号
- ✅ **智能移出**：触发信号、暴涨>30%、超30天自动移出

### 📈 技术指标体系
- ✅ RSI(14) - 超买超卖判断
- ✅ EMA7/EMA25 - 趋势判断
- ✅ ADX(14) - 趋势强度
- ✅ 动态支撑/阻力位
- ✅ 量能倍数分析
- ✅ 综合评级（A/B/C）+ 风险警示

## 🚀 快速开始

### 1. 安装依赖
```bash
cd smart-crypto-alert
npm install
```

### 2. 配置环境变量
```bash
# 复制配置模板
# Windows:
copy env-example.txt .env

# Linux/Mac:
cp env-example.txt .env

# 编辑配置文件
notepad .env  # Windows
nano .env     # Linux/Mac
```

**必填配置**：
1. 找 @BotFather 创建机器人，获取 `TELEGRAM_BOT_TOKEN`
2. 找 @userinfobot 获取你的 `TELEGRAM_CHAT_ID`

详细配置说明见：[CONFIG.md](CONFIG.md)

### 3. 测试功能
```bash
# 测试 Telegram 连接
npm run test-telegram

# 测试形态识别
npm run test-pattern
```

### 4. 启动监控
```bash
npm run start
```

### 5. PM2 部署（推荐生产环境）
```bash
pm2 start src/index.js --name smart-crypto-alert
pm2 save
pm2 startup
```

---

## ⚙️ 配置说明

参见 `.env.example` 注释，主要配置项：

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `ENABLE_5M/15M/1H/4H/1D` | 周期开关 | 5m/15m/1h 开启 |
| `PRICE_THRESHOLD_5M` 等 | 涨跌幅阈值（%） | 3/4/5/6/8 |
| `COOLDOWN_MINUTES` | 冷却时间（分钟） | 30 |
| `VOLUME_MEDIAN_PERIODS` | 量能中位数周期 | 20 |
| `MIN_VOLUME_MULTIPLIER` | 最小量能倍数 | 1.0 |
| `CONCURRENCY_LIMIT` | 并发请求数 | 10 |

---

## 📋 工作流程

### 实时监控（5m/15m/1h/4h/1d）
```
币安API拉取数据 → 计算指标 → 形态识别 → 阈值筛选 → 
BTC过滤 → 冷却检查 → Telegram推送
```

### 埋伏币扫描（每日8点）
```
全市场扫描（日线） → 15维评分 → 筛选≥8分 → 
加入观察池 → 发送日报 → 每小时检查金叉 → 入场提醒
```

### 形态识别融合
```
K线数据 → K线形态检测（12种） + 图表形态检测（4种） → 
多重确认 → 综合评分 → 融合信号
```

---

## 📊 告警示例

### 1. 实时价格异动提醒
```
📊 合约价格异动提醒（BTCUSDT 第1次提醒）

交易对: BTCUSDT
周期: 🟡 15m
变动幅度: +4.35% (上涨)
阈值: 4%
当前价格: 48,500.00

📈 技术分析:
• RSI(14): 65 ✅ 强势
• MA趋势: 🚀 多头排列
• EMA7: 48,200 | EMA25: 47,500
• 量能: ⚡ 放量 2.3x
• ADX: 28 （趋势强）

💰 参考位置:
• 支撑位: $47,500 (EMA25)
• 阻力位: $49,500 (前高)

🔍 形态识别:
• 🔨 锤子线（反转）（置信度75%）
• 🚀 多重看涨信号（K线+图表共振）

💡 综合评级: A级信号
🚀 形态建议: 多重看涨共振（85%）
✅ 建议方向: 可考虑做多

📝 原因分析:
✅ 多头趋势确认
✅ 放量上涨（有买盘）
✅ 趋势强劲（ADX高）

时间: 2025-10-14 12:30:22
```

### 2. 埋伏币日报
```
🔍 埋伏币日报（2025-10-14）

发现 15 个潜力币种，以下是评分最高的标的：

1. ARBUSDT
   评分: 12/15 ⭐⭐⭐⭐
   当前价: $0.8520
   距30日高点: -42.3%
   距60日低点: +8.5%
   RSI: 45 ⬆️
   EMA金叉距离: 1.85%
   整理天数: 12天

2. OPUSDT
   评分: 11/15 ⭐⭐⭐⭐
   当前价: $1.2340
   ...

💡 说明：
• 这些币种当前处于低位筑底阶段
• 评分 ≥8 表示技术面初步具备启动条件
• 等待 EMA 金叉确认后会发送入场提醒
• 建议先加入自选，观察走势

⚠️ 风险提示：底部形态需要时间确认，请控制仓位！
```

### 3. 入场信号提醒
```
🚀 埋伏币入场信号

交易对: ARBUSDT
信号类型: EMA 金叉确认
观察池评分: 12/15
当前价格: $0.8650

📊 技术确认:
• EMA7: 0.8680
• EMA25: 0.8620
• 量能确认: ✅ 是
• 置信度: 85%

💡 操作建议:
• 可考虑轻仓试探
• 建议仓位: 5-10%
• 止损位: EMA25 下方（$0.8362）

⏰ 2025-10-14 14:30:22
```

---

## 🔧 技术说明

### 指标计算
- 所有指标（RSI/EMA/ADX）均由程序计算，非直接读取交易所
- ADX 仅衡量趋势强弱，不分方向
- EMA 使用完整精度浮点计算，避免精度丢失

### 形态识别原理
**K线形态**（technicalindicators 库）：
- 基于单根或 2-3 根 K 线的开高低收关系
- 准确率：85%+

**图表形态**（自定义规则）：
- 双底：两个相近低点（差距<3%）+ 中间回升>5%
- 平台整理：15 根 K 线波动<5% + 放量突破
- V形反转：连续下跌 + 单根大阳线反转>5%
- 准确率：60-75%

**融合确认**：
- K线形态 + 图表形态 + 技术指标多重验证
- 综合准确率：75-85%

### BTC 市场过滤
- 每次扫描前更新 BTC 1小时趋势（EMA + ADX）
- BTC 强空头时（空头排列 + ADX≥25），山寨币上涨信号降级

### 埋伏币评分体系（15分制）
1. 距30日高点回撤>30%（2分）
2. 距60日低点<10%（2分）
3. EMA金叉距离<2%（3分）
4. RSI 40-55 且上升（2分）
5. 整理天数≥10天（2分）
6. 量能温和放大 1.2-1.8x（1分）
7. 成交额>50万USDT（1分）
8. 波动<15%（避免pump）（1分）
9. EMA开始上升（1分）

---

## 📝 注意事项

1. **首次运行**：会拉取所有 USDT 永续合约交易对（约 200+）
2. **代理配置**：如需代理，设置 `HTTP_PROXY` 和 `HTTPS_PROXY`
3. **日志调试**：`LOG_LEVEL=debug` 查看详细数据
4. **资源消耗**：默认并发 10，可根据网络调整
5. **数据源**：Binance Futures API（免 API Key）
6. **风险提示**：
   - 本系统仅供参考，不构成投资建议
   - 形态识别存在误报，需结合实际行情判断
   - 埋伏币扫描基于技术面，不考虑基本面与突发事件
   - 请严格控制仓位，设置止损

---

## 🛠️ 常见问题

**Q: 形态识别准确率如何？**  
A: K线形态 85%+，图表形态 60-75%，融合信号 75-85%。建议配合量能和趋势确认。

**Q: 埋伏币扫描多久运行一次？**  
A: 每天早上 8 点自动运行，观察池每小时检查金叉信号。

**Q: 可以只监控特定币种吗？**  
A: 目前监控所有 USDT 永续合约，如需定制请修改 `monitor.js` 的 `this.symbols` 过滤逻辑。

**Q: BTC 过滤器是否会漏掉机会？**  
A: BTC 强空头时，山寨币逆势上涨通常是诱多，过滤器可降低风险。如需关闭，注释 `telegram.js` 中的 BTC 判断逻辑。

**Q: 如何调整阈值？**  
A: 修改 `.env` 中的 `PRICE_THRESHOLD_*`，建议根据回测结果优化。

---

## 📚 项目结构

```
smart-crypto-alert/
├── src/
│   ├── index.js                   # 入口
│   ├── config/
│   │   └── config.js              # 配置管理
│   ├── indicators/
│   │   └── indicators.js          # RSI/EMA/ADX 计算
│   ├── patterns/
│   │   ├── candlestick.js         # K线形态识别
│   │   ├── chart-patterns.js      # 图表形态识别
│   │   └── pattern-fusion.js      # 融合模块
│   ├── scanners/
│   │   └── ambush-scanner.js      # 埋伏币扫描器
│   ├── services/
│   │   ├── binance.js             # Binance API
│   │   ├── monitor.js             # 监控器
│   │   └── telegram.js            # Telegram 推送
│   ├── utils/
│   │   └── logger.js              # 日志
│   ├── test-telegram.js           # Telegram 测试
│   └── test-pattern.js            # 形态识别测试
├── package.json
├── .env.example
└── README.md
```

---

## 🚀 高级功能：TA-Lib 微服务（可选）

### 📈 升级到 62 种专业形态识别

本项目支持可选的 **TA-Lib 微服务**，将形态识别能力从 12 种提升到 **62 种专业级形态**！

#### 功能对比

| 特性 | 基础版 | TA-Lib 版 |
|------|--------|-----------|
| K线形态数量 | 12 种 | 62 种 ⭐ |
| 准确率 | 85% | 90%+ ⭐ |
| 技术标准 | 社区库 | 行业标准 ⭐ |
| 部署方式 | 单服务 | 微服务架构 |

#### 快速开始

**Docker 方式**（推荐）：
```bash
cd python-service
docker-compose up -d
cd ..
npm start
```

**非 Docker 方式**：
```bash
# 详见部署文档
# DEPLOY_WITHOUT_DOCKER.md - 完整部署指南
# DEPLOY_CHECKLIST.md - 快速检查清单
```

#### 特点

- ✅ **自动降级**：Python 服务不可用时自动切换到基础形态
- ✅ **零代码修改**：已完全集成，开箱即用
- ✅ **独立部署**：Python 服务可独立启停
- ✅ **62 种形态**：包括三白兵、乌云盖顶、早晨之星等专业形态

#### 相关文档

- 📘 [完整部署文档](DEPLOY_WITHOUT_DOCKER.md) - 一步一步部署指南
- 📋 [部署检查清单](DEPLOY_CHECKLIST.md) - 快速部署步骤
- 🔧 [TA-Lib 安装指南](TALIB_SETUP.md) - 各平台安装方法
- 📦 [依赖管理说明](DEPENDENCY_EXPLAINED.md) - 了解依赖机制
- 🚀 [5分钟快速开始](QUICK_START_TALIB.md) - 最快部署方式

---

## 📄 License

MIT

---

## 💡 常见问题

### Q: 埋伏币是自动加入观察池还是手动？
**A**: 完全自动！扫描发现评分≥7的币种自动加入，触发信号后自动移出，无需任何手动操作。

### Q: 扫描频率是多少？
**A**: 每6小时扫描一次（2:00, 8:00, 14:00, 20:00），覆盖全球时段。

### Q: TA-Lib服务不可用怎么办？
**A**: 系统会自动降级到12种基础形态，主服务继续正常运行。

### Q: 如何查看观察池？
**A**: 发送Telegram命令 `/watchlist` 查看当前观察池。

### Q: 如何调整配置？
**A**: 编辑 `.env` 文件，修改阈值、周期开关等参数。

---

## 📚 完整文档（3个）

| 文档 | 用途 | 必读 |
|------|------|------|
| **[README.md](README.md)** | 项目介绍、功能说明 | ⭐⭐⭐ 从这里开始 |
| **[CONFIG.md](CONFIG.md)** | 配置文件详细说明（.env） | ⭐⭐ 配置时看 |
| **[DEPLOY.md](DEPLOY.md)** | 服务器部署指南 | ⭐⭐⭐ 部署必看 |
| **[python-service/README.md](python-service/README.md)** | TA-Lib微服务（可选） | ⭐ 进阶功能 |

---

## 🙏 致谢

- [technicalindicators](https://github.com/anandanand84/technicalindicators) - K线形态识别库
- [TA-Lib](https://ta-lib.org/) - 专业技术分析库（可选微服务）
- [node-telegram-bot-api](https://github.com/yagop/node-telegram-bot-api) - Telegram Bot
- Binance Futures API

